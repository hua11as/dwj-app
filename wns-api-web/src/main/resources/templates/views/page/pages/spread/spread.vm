#set($title = "推广")

#extends("page/layouts/main.vm")

#block("head_meta")
<script>/**
 * YDUI 可伸缩布局方案
 * rem计算方式：设计图尺寸px / 100 = 实际rem  例: 100px = 1rem
 */
!function (window) {

    /* 设计图文档宽度 */
    var docWidth = 750;

    var doc = window.document,
        docEl = doc.documentElement,
        resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize';

    var recalc = (function refreshRem () {
        var clientWidth = docEl.getBoundingClientRect().width;

        /* 8.55：小于320px不再缩小，11.2：大于420px不再放大 */
        docEl.style.fontSize = Math.max(Math.min(20 * (clientWidth / docWidth), 11.2), 8.55) * 5 + 'px';

        return refreshRem;
    })();

    /* 添加倍屏标识，安卓倍屏为1 */
    docEl.setAttribute('data-dpr', window.navigator.appVersion.match(/iphone/gi) ? window.devicePixelRatio : 1);

    if (/iP(hone|od|ad)/.test(window.navigator.userAgent)) {
        /* 添加IOS标识 */
        doc.documentElement.classList.add('ios');
        /* IOS8以上给html添加hairline样式，以便特殊处理 */
        if (parseInt(window.navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/)[1], 10) >= 8)
            doc.documentElement.classList.add('hairline');
    }

    if (!doc.addEventListener) return;
    window.addEventListener(resizeEvt, recalc, false);
    doc.addEventListener('DOMContentLoaded', recalc, false);

}(window);
</script>
<link rel="stylesheet" type="text/css" href="//mobile.xiaobaii.com/roncoo-h5/static/css/page/demo_49a5b2e.css">
#end

#block("body")

<section class="g-flexview">
	<!--header-->
	<header class="m-navbar index-header">
		<a href="javascript:;" id="nav-back" class="navbar-item"><i class="back-ico"></i></a>
		<div class="navbar-center"><span class="navbar-title">推广</span></div>
		<div class="navbar-item index-navbar-income">
			<a href="javascript:;" class="btn btn-primary" id="commision-info">佣金说明</a>
		</div>
	</header>

	<div class="g-scrollview" style="padding-bottom: 1rem">
		<div class="discover-txt">
			<div class="box-tips">
				<h3><i class="icon-tips"></i>躺赚操作提示</h3>
				<p>1，点击"生成推广二维码"即获取二维码图。</p>
				<p>2，长按二维码即可报存或者转发。</p>
				<p>3，将您的二维码图转发好友，开启躺赚模式</p>
			</div>
			#if($!url)
				<div id="qrcode">
					<img src="$!url" alt="">
					<!--<img src="/static/images/showqrcode.jpeg" alt="">-->
				</div>
				<img id="img" />
			#else
				<div id="qrcode" style="display: none">
					<img src="" alt="">
				</div>
				<button type="button" class="btn-block btn-primary btn showQrcode">生成推广二维码</button>
			#end
		</div>
	</div>
	<input type="hidden" name="userId" id="userId" value="$!userId">
	#parse("../pages/common/_nav.vm")
</section>

#parse("../pages/common/_script.vm")
<script src="//mobile.xiaobaii.com/roncoo-h5/static/js/lib/qrcode.min_517b55d.js"></script>
<script src="//mobile.xiaobaii.com/roncoo-h5/static/js/lib/html2canvas.min_0e52edb.js"></script>
<script src="//mobile.xiaobaii.com/roncoo-h5/static/js/page/home_675eca0.js"></script>
<script>
	var canvas = document.createElement("canvas");
	var scale = 4;
	var width = $('#qrcode').width();
	var height = $('#qrcode').height();
	canvas.width = width * scale; 
	canvas.height = height * scale; 
	canvas.style.width = width;
    canvas.style.height = height; 
	console.log(width, height, canvas.width, canvas.height)
    canvas.getContext("2d").scale(scale, scale); 

	var saveImg = document.getElementById('saveImg');
	html2canvas(document.getElementById('qrcode'), {
		scale: 1,
		canvas: canvas,
		logging: true,
		background: "#f2f2f2",
		useCORS: true,
		width: width,
		height: height
	}).then(function (canvas) {
		var dataUrl = canvas.toDataURL("jpeg");
		//$('#img').attr('src', dataUrl).css({
			//width:width,
			//height:height
		//})
		//console.log(dataUrl)
	});
</script>
#end

  ## auto inject by fis3-preprocess-extlang
  #require("page/pages/spread/spread.vm")
#end